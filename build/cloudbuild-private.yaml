steps:
  - name: gcr.io/cloud-builders/docker
    id: build-pusher
    waitFor: ['-']
    args:
      - build
      - "-t"
      - gcr.io/$PROJECT_ID/cloud-builders/puppet-discovery-pusher
      - "-f"
      - build/pusher.Dockerfile
      - "."
  - name: gcr.io/cloud-builders/docker
    id: build-tagger
    waitFor: ['-']
    args:
      - build
      - "-t"
      - gcr.io/$PROJECT_ID/cloud-builders/puppet-discovery-tagger
      - "-f"
      - build/tagger.Dockerfile
      - "."
  # demo
  - name: "gcr.io/$PROJECT_ID/cloud-builders/puppet-discovery-pusher"
    id: push-demo
    waitFor: ['build-pusher']
    args:
      - 'demo'
  - name: "gcr.io/$PROJECT_ID/cloud-builders/puppet-discovery-tagger"
    id: tag-demo
    waitFor: ['build-tagger']
    args:
      - 'demo'
      - $PROJECT_ID

  # staging
  - name: "gcr.io/$PROJECT_ID/cloud-builders/puppet-discovery-pusher"
    id: push-staging
    waitFor: ['build-pusher']
    args:
      - 'staging'

  # preview
  - name: "gcr.io/$PROJECT_ID/cloud-builders/puppet-discovery-pusher"
    id: push-preview
    waitFor: ['build-pusher']
    args:
      - 'preview'
